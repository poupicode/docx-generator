var l=Object.defineProperty;var d=(a,t,r)=>t in a?l(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r;var s=(a,t,r)=>(d(a,typeof t!="symbol"?t+"":t,r),r);import{createReport as c}from"https://unpkg.com/docx-templates/lib/browser.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();class u{constructor(){s(this,"templateFile",null);s(this,"jsonData",null);this.initializeApp()}initializeApp(){this.setupFileInput(),this.setupJsonEditor(),this.setupGenerateButton(),this.loadDefaultData()}setupFileInput(){const t=document.getElementById("docxTemplate"),r=document.getElementById("templateDisplay");t.addEventListener("change",n=>{var o;const e=(o=n.target.files)==null?void 0:o[0];e&&(this.templateFile=e,r.innerHTML=`
          <div style="color: #48bb78;">✅ ${e.name}</div>
          <small style="color: #718096; margin-top: 10px; display: block;">
            Taille: ${this.formatFileSize(e.size)}
          </small>
        `,r.classList.add("has-file"))}),r.addEventListener("dragover",n=>{n.preventDefault(),r.style.borderColor="#4facfe",r.style.background="#f0f9ff"}),r.addEventListener("dragleave",n=>{n.preventDefault(),r.style.borderColor="#cbd5e0",r.style.background=""}),r.addEventListener("drop",n=>{var o;n.preventDefault();const e=(o=n.dataTransfer)==null?void 0:o.files;e&&e.length>0&&(e[0].name.endsWith(".docx")?(t.files=e,t.dispatchEvent(new Event("change"))):alert("Veuillez sélectionner un fichier .docx")),r.style.borderColor="#cbd5e0",r.style.background=""})}setupJsonEditor(){const t=document.getElementById("jsonData");t.addEventListener("input",()=>{try{this.jsonData=JSON.parse(t.value),t.style.borderColor="#48bb78"}catch{t.style.borderColor="#f56565"}})}setupGenerateButton(){document.getElementById("generateBtn").addEventListener("click",()=>{this.generateReport()})}async loadDefaultData(){const t={consultation:{roomName:"Salle-Consultation-001",date:"2025-07-21",time:"14:30",connectionStatus:"Connecté"},doctor:{firstName:"Marie",name:"Dubois",occupation:"Cardiologue"},patient:{firstName:"Jean",name:"Martin",birthDate:"1980-05-15",gender:"Masculin",patientNumber:"PAT-2025-0123",consultationReason:"Contrôle de routine cardiaque"},measures:{tensiometre:[{systolique:"120 mmHg",diastolique:"80 mmHg",frequence:"72 bpm",heure:"14:35"}],oxymetre:[{saturation:"98%",frequence:"74 bpm",heure:"14:37"}],thermometre:[{temperature:"36.8°C",heure:"14:38"}]},generation:{date:"2025-07-21",time:"15:00"}},r=document.getElementById("jsonData");r.value=JSON.stringify(t,null,2),this.jsonData=t,r.style.borderColor="#48bb78"}async generateReport(){if(!this.templateFile){alert("Merci de sélectionner un template DOCX");return}if(!this.jsonData){alert("Merci de fournir des données JSON valides");return}const t=document.getElementById("generateBtn");t.disabled=!0,t.innerHTML="⏳ Génération en cours...";try{const r=await this.readFileAsArrayBuffer(this.templateFile),n=await c({template:new Uint8Array(r),data:this.jsonData,noSandbox:!0,cmdDelimiter:["{","}"]}),e=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});this.downloadFile(e,"rapport.docx"),t.innerHTML="✅ Rapport généré !",setTimeout(()=>{t.innerHTML="🚀 Générer le rapport",t.disabled=!1},2e3)}catch(r){console.error("Erreur lors de la génération:",r),alert("Erreur lors de la génération du rapport. Vérifiez le template et les données."),t.innerHTML="🚀 Générer le rapport",t.disabled=!1}}readFileAsArrayBuffer(t){return new Promise((r,n)=>{const e=new FileReader;e.onerror=n,e.onload=()=>r(e.result),e.readAsArrayBuffer(t)})}downloadFile(t,r){const n=URL.createObjectURL(t),e=document.createElement("a");e.href=n,e.download=r,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(n)}formatFileSize(t){if(t===0)return"0 Bytes";const r=1024,n=["Bytes","KB","MB","GB"],e=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,e)).toFixed(2))+" "+n[e]}}document.addEventListener("DOMContentLoaded",()=>{new u});
